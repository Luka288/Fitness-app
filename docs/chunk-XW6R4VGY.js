import{d as R}from"./chunk-FM6GJ4KO.js";import{a as p,c as d,d as h,f as l,g as v,j,m as w,o as N}from"./chunk-IB7F6B6N.js";import{Hc as A,Ic as D,Kc as S,Nc as k,Qc as L,R as m,X as n,a as I,e as o,l as u,n as c,s as y,t as P}from"./chunk-WI2OL4WN.js";var f=class a{enablePanel=new u(!0);forgotPasswordToggle=new u(!1);registerLoading=new u(!1);isRegeisterd=new u(!1);static \u0275fac=function(r){return new(r||a)};static \u0275prov=m({token:a,factory:a.\u0275fac,providedIn:"root"})};var T=class a{Fire=n(j);FireAuth=n(S);router=n(R);alertService=n(N);booleanService=n(f);registerUser(t,r,s){return o(this,null,function*(){this.booleanService.registerLoading.next(!0);try{let e=yield k(this.FireAuth,t,r);yield D(e.user,{displayName:s}),yield this.storePublicInfo({username:e.user.displayName,userImage:e.user.photoURL}),yield this.saveUser(e.user.uid,e.user.email,e.user.displayName),this.booleanService.isRegeisterd.next(!0)}catch(e){throw e}finally{this.booleanService.registerLoading.next(!1),this.router.navigateByUrl("/dashboard")}})}loginUser(t,r){return o(this,null,function*(){return L(this.FireAuth,t,r).then(()=>{this.router.navigateByUrl("dashboard")})})}saveUser(t,r,s){return o(this,null,function*(){let e=this.FireAuth.currentUser;if(!e)return;let i=w(this.Fire,`users/${e.uid}`),b={uid:e.uid??t,email:e.email??r,displayName:e.displayName??s,photoURL:e.photoURL??""},{uid:g,email:x,displayName:U,photoURL:F}=b;this.storePublicInfo({username:U,userImage:F});try{return v(i,{uid:g,email:x,displayName:U,photoURL:F},{merge:!0}),!0}catch(B){return B}})}storePublicInfo(t){return o(this,null,function*(){let r=this.FireAuth.currentUser;if(!r)return;let s={username:t.username,userImage:t.userImage},e=w(this.Fire,`publicData/${r.uid}`);try{yield v(e,s,{merge:!0})}catch(i){console.error("Error saving public data:",i)}})}getPublicUsers(){let t=p(this.Fire,"publicData");return c(l(t).then(r=>r.docs.map(e=>{let i=e.data();return I({},i)})))}checkUserProps(t,r){let s=p(this.Fire,"publicData"),e=d(s,h("username","==",t)),i=d(s,h("email","==",r));return P([c(l(e)),c(l(i))]).pipe(y(([b,g])=>({usernameTaken:!b.empty,emailTaken:!g.empty})))}checkUsername(t){let r=p(this.Fire,"publicData"),s=d(r,h("username","==",t));return c(l(s)).pipe(y(e=>!e.empty))}passwordReset(t){return o(this,null,function*(){try{A(this.FireAuth,t)}catch(r){throw this.alertService.toast("Something went wrong","error","red"),r}})}currentUser(){return o(this,null,function*(){return this.FireAuth.currentUser||!1})}static \u0275fac=function(r){return new(r||a)};static \u0275prov=m({token:a,factory:a.\u0275fac,providedIn:"root"})};export{f as a,T as b};
