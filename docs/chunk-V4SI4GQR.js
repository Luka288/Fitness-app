import{d as I}from"./chunk-FM6GJ4KO.js";import{a as c,c as m,d as l,f as u,g,j as N,m as b,o as L}from"./chunk-IB7F6B6N.js";import{Hc as P,Ic as A,Kc as D,Nc as R,Qc as k,R as w,X as n,a as U,e as i,n as o,s as f,t as F}from"./chunk-WI2OL4WN.js";var S=class p{Fire=n(N);FireAuth=n(D);router=n(I);alertService=n(L);registerUser(t,r,s){return i(this,null,function*(){try{let e=yield R(this.FireAuth,t,r);yield A(e.user,{displayName:s}),yield this.storePublicInfo({username:e.user.displayName,userImage:e.user.photoURL}),yield this.saveUser(e.user.uid,e.user.email,e.user.displayName)}catch{}})}loginUser(t,r){return i(this,null,function*(){return k(this.FireAuth,t,r).then(()=>{this.router.navigateByUrl("dashboard")})})}saveUser(t,r,s){return i(this,null,function*(){let e=this.FireAuth.currentUser;if(!e)return;let a=b(this.Fire,`users/${e.uid}`),h={uid:e.uid??t,email:e.email??r,displayName:e.displayName??s,photoURL:e.photoURL??""},{uid:d,email:T,displayName:y,photoURL:v}=h;this.storePublicInfo({username:y,userImage:v});try{return g(a,{uid:d,email:T,displayName:y,photoURL:v},{merge:!0}),!0}catch(E){return E}})}storePublicInfo(t){return i(this,null,function*(){let r=this.FireAuth.currentUser;if(!r)return;let s={username:t.username,userImage:t.userImage},e=b(this.Fire,`publicData/${r.uid}`);try{yield g(e,s,{merge:!0})}catch(a){console.error("Error saving public data:",a)}})}getPublicUsers(){let t=c(this.Fire,"publicData");return o(u(t).then(r=>r.docs.map(e=>{let a=e.data();return U({},a)})))}checkUserProps(t,r){let s=c(this.Fire,"publicData"),e=m(s,l("username","==",t)),a=m(s,l("email","==",r));return F([o(u(e)),o(u(a))]).pipe(f(([h,d])=>({usernameTaken:!h.empty,emailTaken:!d.empty})))}checkUsername(t){let r=c(this.Fire,"publicData"),s=m(r,l("username","==",t));return o(u(s)).pipe(f(e=>!e.empty))}passwordReset(t){return i(this,null,function*(){try{P(this.FireAuth,t)}catch(r){throw this.alertService.toast("Something went wrong","error","red"),r}})}currentUser(){return i(this,null,function*(){return this.FireAuth.currentUser||!1})}static \u0275fac=function(r){return new(r||p)};static \u0275prov=w({token:p,factory:p.\u0275fac,providedIn:"root"})};export{S as a};
