import{b as o,g as C,h as I,i as S,j as O,l as u,o as k}from"./chunk-SXNKKB2I.js";import{Kc as w,R as g,X as h,a as f,b as p,e as D,o as l,s as n,t as b}from"./chunk-4UOH3M65.js";var $=class y{auth=h(w);fire=h(O);alerts=h(k);saveData(t){return D(this,null,function*(){try{let e=this.auth.currentUser;if(!e)return;let r=new Date().toISOString().split("T")[0],a=o(this.fire,`users/${e.uid}`);yield I(a,{activities:S(p(f({},t),{date:r,savedAt:new Date().toISOString()}))}),this.alerts.toast("Data saved!","success","")}catch{this.alerts.toast("Something went wrong try again","error","red")}})}userActivity(){let t=this.auth.currentUser;if(!t)return l([]);let e=o(this.fire,`users/${t.uid}`);return u(e).pipe(n(r=>((r??{}).activities||[]).map(a=>p(f({},a),{burnedCalories:Math.floor(a.burnedCalories)}))))}addGoal(t){let e=this.auth.currentUser;if(!e)return;let r=new Date().toISOString().split("T")[0],a=o(this.fire,`users/${e.uid}/dailyGoals/${r}`);try{C(a,{goal:t.goal,type:t.type,addDate:t.addDate},{merge:!0}),this.alerts.toast("Goal saved!","success","green")}catch{}}goalCalculate(){let t=this.auth.currentUser;if(!t)return l(null);let e=new Date().toISOString().split("T")[0],r=o(this.fire,`users/${t.uid}/dailyGoals/${e}`),a=o(this.fire,`users/${t.uid}`),s=u(r).pipe(n(i=>i)),d=u(a).pipe(n(i=>i));return b([s,d]).pipe(n(([i,v])=>{if(!i||!v)return null;let A=(v.activities||[]).filter(c=>c.date===e).reduce((c,m)=>i.type==="CALORIES"?c+(m.burnedCalories||0):i.type==="DISTANCE"?c+(m.distance||0):c,0);return p(f({},i),{progress:Math.round(A)||0})}))}getChartedWorkouts(){let t=this.auth.currentUser;if(!t)return l([]);let e=o(this.fire,`users/${t.uid}`);return u(e).pipe(n(r=>r?(r.activities||[]).slice(-7).map(s=>({burnedCalories:Math.round(s.burnedCalories),activity:s.activityName,date:s.date})):[]))}prWorkout(){let t=this.auth.currentUser;if(!t)return l();let e=o(this.fire,`users/${t.uid}`);return u(e).pipe(n(r=>{if(!r)return null;let a=r,s=a.activities?a.activities:[];return s.length===0?null:s.reduce((d,i)=>i.burnedCalories>d.burnedCalories?i:d)}))}static \u0275fac=function(e){return new(e||y)};static \u0275prov=g({token:y,factory:y.\u0275fac,providedIn:"root"})};export{$ as a};
