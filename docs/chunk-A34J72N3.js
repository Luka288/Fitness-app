import{d as F}from"./chunk-6FF5SCTN.js";import{a as l,c as p,d as h,f as m,g as N,j as P,m as B,o as E}from"./chunk-SXNKKB2I.js";import{Hc as A,Ic as w,Kc as R,Nc as k,Qc as I,R as U,X as c,a as g,b,e as a,n as u,s as y,t as v}from"./chunk-4UOH3M65.js";var L=class d{Fire=c(P);FireAuth=c(R);router=c(F);alertService=c(E);registerUser(r,t,s){return a(this,null,function*(){return k(this.FireAuth,r,t).then(e=>{w(e.user,{displayName:s}),this.saveUser(e.user.uid,e.user.email||r,e.user.displayName||s)})})}loginUser(r,t){return a(this,null,function*(){return I(this.FireAuth,r,t).then(()=>{this.router.navigateByUrl("dashboard")})})}saveUser(r,t,s){return a(this,null,function*(){let e=this.FireAuth.currentUser;if(!e)return;let i=B(this.Fire,`users/${e.uid}`),o={uid:e.uid??r,email:e.email??t,displayName:e.displayName??s,photoURL:e.photoURL??""},{uid:n,email:f,displayName:O,photoURL:S}=o;try{return N(i,{uid:n,email:f,displayName:O,photoURL:S},{merge:!0}),!0}catch(T){return T}})}getAllUsers(){let r=l(this.Fire,"users");return u(m(r).then(t=>t.docs.map(e=>{let i=e.data(),o=(i.activities||[]).reduce((n,f)=>Math.floor(n+f.burnedCalories),0);return b(g({},i),{totalBurned:o})}).sort((e,i)=>(i.totalBurned||0)-(e.totalBurned||0))))}checkUserProps(r,t){let s=l(this.Fire,"users"),e=p(s,h("displayName","==",r)),i=p(s,h("email","==",t));return v([u(m(e)),u(m(i))]).pipe(y(([o,n])=>({usernameTaken:!o.empty,emailTaken:!n.empty})))}checkEmail(r){let t=l(this.Fire,"users"),s=p(t,h("email","==",r));return u(m(s)).pipe(y(e=>!e.empty))}passwordReset(r){return a(this,null,function*(){try{A(this.FireAuth,r)}catch(t){throw this.alertService.toast("Something went wrong","error","red"),t}})}currentUser(){return a(this,null,function*(){return this.FireAuth.currentUser||!1})}static \u0275fac=function(t){return new(t||d)};static \u0275prov=U({token:d,factory:d.\u0275fac,providedIn:"root"})};export{L as a};
